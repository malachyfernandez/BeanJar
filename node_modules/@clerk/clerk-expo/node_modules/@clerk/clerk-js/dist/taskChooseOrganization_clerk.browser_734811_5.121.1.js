"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["7814"],{8181:function(e,t,a){a.d(t,{D:()=>l});var i=a(73312),o=a(6654),n=a(25623),r=a(64204),s=a(17703);let l=e=>{let{organization:t,showLoadingSpinner:a,...l}=e;return(0,i.BX)(r.Col,{elementDescriptor:r.descriptors.organizationAvatarUploaderContainer,children:[(0,i.tZ)(r.Text,{variant:"subtitle",sx:e=>({textAlign:"left",marginBottom:e.space.$2}),localizationKey:(0,s.u1)("organizationProfile.start.profileSection.uploadAction__title")}),(0,i.tZ)(o.C,{...l,title:(0,s.u1)("userProfile.profilePage.imageFormTitle"),avatarPreview:(0,i.tZ)(n.l,{size:e=>e.sizes.$16,showLoadingSpinner:a,...t})})]})}},57484:function(e,t,a){a.d(t,{AO:()=>i,Sz:()=>o});let i={userMemberships:{infinite:!0},userInvitations:{infinite:!0},userSuggestions:{infinite:!0,status:["pending","accepted"]}},o=(e,t,a)=>{if(void 0===t)return[{data:[e],total_count:1}];let i=t?.[t.length-1]?.total_count||1;return t.map(t=>{if(void 0===t)return t;let o=t.data.map(t=>t.id===e.id?{...e}:t);return{...t,data:o,total_count:"negative"===a?i-1:i}})}},7008:function(e,t,a){a.r(t),a.d(t,{TaskChooseOrganization:()=>N});var i=a(73312),o=a(61869),n=a(69144),r=a(11576),s=a(64204),l=a(92418),c=a(2672),d=a(92654),g=a(96352),u=a(54264),h=a(76028),z=a(25135),p=a(41024),m=a(20237),C=a(57484),y=a(86988),O=a(42305),Z=a(35973),b=a(34174),k=a(88870);let f=e=>{let t=(0,c.useCardState)(),{user:a}=(0,o.aF)(),{ref:n,userMemberships:r,userSuggestions:g,userInvitations:u}=(0,h.H)(),z=r?.isLoading||u?.isLoading||g?.isLoading,p=r?.hasNextPage||u?.hasNextPage||g?.hasNextPage,C=u.data?.filter(e=>!!e),y=g.data?.filter(e=>!!e);return(0,i.BX)(i.HY,{children:[(0,i.BX)(d.h.Root,{showLogo:!0,sx:e=>({padding:`${e.space.$none} ${e.space.$8}`}),children:[(0,i.tZ)(d.h.Title,{localizationKey:(0,s.localizationKeys)("taskChooseOrganization.chooseOrganization.title")}),(0,i.tZ)(d.h.Subtitle,{localizationKey:a?.createOrganizationEnabled?(0,s.localizationKeys)("taskChooseOrganization.chooseOrganization.subtitle"):(0,s.localizationKeys)("taskChooseOrganization.chooseOrganization.subtitle__createOrganizationDisabled")})]}),(0,i.tZ)(l.Z.Alert,{sx:e=>({margin:`${e.space.$none} ${e.space.$8}`}),children:t.error}),(0,i.tZ)(s.Col,{elementDescriptor:s.descriptors.main,children:(0,i.tZ)(m.o2,{elementDescriptor:s.descriptors.taskChooseOrganizationPreviewItems,children:(0,i.BX)(O.eX,{role:"menu",children:[(r.count||0)>0&&r.data?.map(e=>(0,i.tZ)(_,{...e},e.id)),!r.hasNextPage&&C?.map(e=>(0,i.tZ)(w,{...e},e.id)),!r.hasNextPage&&!u.hasNextPage&&y?.map(e=>(0,i.tZ)(v,{...e},e.id)),(p||z)&&(0,i.tZ)(m.pr,{ref:n}),(0,i.tZ)(S,{onCreateOrganizationClick:()=>{t.setError(void 0),e.onCreateOrganizationClick()}})]})})})]})},_=e=>{let{user:t}=(0,o.aF)(),a=(0,c.useCardState)(),{navigateOnSetActive:n}=(0,y.G)(),{redirectUrlComplete:r}=(0,y._)(),{isLoaded:l,setActive:d}=(0,o.eW)(),{t:g}=(0,s.useLocalizations)();return l?(0,i.tZ)(m.Td,{elementDescriptor:s.descriptors.taskChooseOrganizationPreviewButton,onClick:()=>{let i;return i=e.organization,a.runAsync(async()=>{try{await d({organization:i,navigate:async({session:e})=>{await n?.({session:e,redirectUrlComplete:r})}})}catch(e){if(!(0,p.kD)(e))return void(0,k.S3)(e,[],a.setError);switch(e.errors?.[0]?.code){case"organization_not_found_or_unauthorized":case"not_a_member_in_organization":t?.createOrganizationEnabled?a.setError(g((0,s.localizationKeys)("unstable__errors.organization_not_found_or_unauthorized"))):a.setError(g((0,s.localizationKeys)("unstable__errors.organization_not_found_or_unauthorized_with_create_organization_disabled")));break;default:(0,k.S3)(e,[],a.setError)}}})},children:(0,i.tZ)(Z.Z,{elementId:"taskChooseOrganization",mainIdentifierSx:m.fq,organization:e.organization})}):null},w=e=>{let t=(0,c.useCardState)(),{getOrganization:a}=(0,o.cL)(),[r,l]=(0,n.useState)(null),{userInvitations:d}=(0,o.eW)({userInvitations:C.AO.userInvitations});return r?(0,i.tZ)(_,{organization:r}):(0,i.tZ)(m.ij,{organizationData:e.publicOrganizationData,elementId:"taskChooseOrganization",elementDescriptor:s.descriptors.taskChooseOrganizationPreviewItem,children:(0,i.tZ)(m.De,{isLoading:t.isLoading,onClick:()=>t.runAsync(async()=>[await e.accept(),await a(e.publicOrganizationData.id)]).then(([e,t])=>{d?.setData?.(t=>(0,C.Sz)(e,t,"negative")),l(t)}).catch(e=>(0,k.S3)(e,[],t.setError)),localizationKey:(0,s.localizationKeys)("taskChooseOrganization.chooseOrganization.action__invitationAccept")})})},v=(0,c.withCardStateProvider)(e=>{let t=(0,c.useCardState)(),{userSuggestions:a}=(0,o.eW)({userSuggestions:C.AO.userSuggestions});return(0,i.tZ)(m.ij,{organizationData:e.publicOrganizationData,elementId:"taskChooseOrganization",elementDescriptor:s.descriptors.taskChooseOrganizationPreviewItem,children:"accepted"===e.status?(0,i.tZ)(s.Text,{colorScheme:"secondary",localizationKey:(0,s.localizationKeys)("taskChooseOrganization.chooseOrganization.suggestionsAcceptedLabel")}):(0,i.tZ)(m.De,{onClick:()=>t.runAsync(e.accept).then(e=>a?.setData?.(t=>(0,C.Sz)(e,t))).catch(e=>(0,k.S3)(e,[],t.setError)),isLoading:t.isLoading,localizationKey:(0,s.localizationKeys)("taskChooseOrganization.chooseOrganization.action__suggestionsAccept")})})}),S=({onCreateOrganizationClick:e})=>{let{user:t}=(0,o.aF)();return t?.createOrganizationEnabled?(0,i.tZ)(O.aU,{elementDescriptor:s.descriptors.taskChooseOrganizationCreateOrganizationActionButton,icon:b.mm,label:(0,s.localizationKeys)("taskChooseOrganization.chooseOrganization.action__createOrganization"),onClick:e,sx:e=>({borderTopWidth:e.borderWidths.$normal,borderTopStyle:e.borderStyles.$solid,borderTopColor:e.colors.$borderAlpha100,padding:`${e.space.$5} ${e.space.$5}`}),iconSx:e=>({width:e.sizes.$9,height:e.sizes.$6})}):null};var $=a(8181),D=a(70431),K=a(19460),x=a(68487),P=a(53412),A=a(7259),L=a(36788),I=a(30215);function F({organizationCreationDefaults:e}){let t=T(e?.advisory);return t?(0,i.tZ)(I.bZ,{colorScheme:"warning",children:(0,i.tZ)(s.Text,{colorScheme:"warning",localizationKey:t,variant:"caption"})}):null}let T=e=>e&&"organization_already_exists"===e.code?(0,s.localizationKeys)("taskChooseOrganization.alerts.organizationAlreadyExists",{organizationDomain:e.meta.organization_domain,organizationName:e.meta.organization_name}):null,B=e=>{let t=(0,c.useCardState)(),{navigateOnSetActive:a}=(0,y.G)(),{redirectUrlComplete:l}=(0,y._)(),{createOrganization:g,isLoaded:u,setActive:h}=(0,o.eW)({userMemberships:C.AO.userMemberships}),{organizationSettings:z}=(0,r.useEnvironment)(),[p,m]=(0,n.useState)(),O=(0,L.Yp)("name",e.organizationCreationDefaults?.form?.name??"",{type:"text",label:(0,s.localizationKeys)("taskChooseOrganization.createOrganization.formFieldLabel__name"),placeholder:(0,s.localizationKeys)("taskChooseOrganization.createOrganization.formFieldInputPlaceholder__name")}),Z=(0,L.Yp)("slug",e.organizationCreationDefaults?.form?.slug??"",{type:"text",label:(0,s.localizationKeys)("taskChooseOrganization.createOrganization.formFieldLabel__slug"),placeholder:(0,s.localizationKeys)("taskChooseOrganization.createOrganization.formFieldInputPlaceholder__slug")}),f=!z.slug.disabled,_=async e=>{if(e.preventDefault(),u)try{let e={name:O.value};f&&(e.slug=Z.value);let t=await g(e),i=w(t);await Promise.allSettled([i]),await h({organization:t,navigate:async({session:e})=>{await a?.({session:e,redirectUrlComplete:l})}})}catch(e){(0,k.S3)(e,[O,Z],t.setError)}},w=async e=>{if(p)await e.setLogo({file:p});else if(I){let t=await fetch(I),a=await t.blob(),i=new File([a],"logo",{type:a.type});await e.setLogo({file:i})}},v=e=>{Z.setValue(e)},S=!O.value||!u,I=void 0===p?e.organizationCreationDefaults?.form?.logo:void 0;return(0,i.BX)(i.HY,{children:[(0,i.BX)(d.h.Root,{showLogo:!0,sx:e=>({padding:`${e.space.$none} ${e.space.$8}`}),children:[(0,i.tZ)(d.h.Title,{localizationKey:(0,s.localizationKeys)("taskChooseOrganization.createOrganization.title")}),(0,i.tZ)(d.h.Subtitle,{localizationKey:(0,s.localizationKeys)("taskChooseOrganization.createOrganization.subtitle")})]}),(0,i.tZ)(x.Y,{sx:e=>({padding:`${e.space.$none} ${e.space.$10} ${e.space.$8}`}),children:(0,i.BX)(D.l.Root,{onSubmit:_,children:[(0,i.tZ)(F,{organizationCreationDefaults:e.organizationCreationDefaults}),(0,i.tZ)($.D,{organization:{name:O.value,imageUrl:I??void 0},onAvatarChange:async e=>await m(e),onAvatarRemove:p||I?()=>(t.setIdle(),m(null)):null,showLoadingSpinner:!!I,avatarPreviewPlaceholder:(0,i.tZ)(P.h,{variant:"ghost","aria-label":"Upload organization logo",icon:(0,i.tZ)(s.Icon,{size:"md",icon:b.gq,sx:e=>({color:e.colors.$colorMutedForeground,transitionDuration:e.transitionDuration.$controls})}),sx:e=>({width:e.sizes.$16,height:e.sizes.$16,borderRadius:e.radii.$md,borderWidth:e.borderWidths.$normal,borderStyle:e.borderStyles.$dashed,borderColor:e.colors.$borderAlpha200,backgroundColor:e.colors.$neutralAlpha50,":hover":{backgroundColor:e.colors.$neutralAlpha50,svg:{transform:"scale(1.2)"}}})})}),(0,i.tZ)(D.l.ControlRow,{elementId:O.id,children:(0,i.tZ)(D.l.PlainInput,{...O.props,onChange:e=>{O.setValue(e.target.value),v((0,A.q)(e.target.value))},isRequired:!0,autoFocus:!0,ignorePasswordManager:!0})}),f&&(0,i.tZ)(D.l.ControlRow,{elementId:Z.id,children:(0,i.tZ)(D.l.PlainInput,{...Z.props,onChange:e=>v(e.target.value),isRequired:!0,pattern:"^(?=.*[a-z0-9])[a-z0-9\\-]+$",ignorePasswordManager:!0})}),(0,i.BX)(K.K,{sx:()=>({flexDirection:"column"}),children:[(0,i.tZ)(D.l.SubmitButton,{block:!0,isDisabled:S,localizationKey:(0,s.localizationKeys)("taskChooseOrganization.createOrganization.formButtonSubmit")}),e.onCancel&&(0,i.tZ)(D.l.ResetButton,{localizationKey:(0,s.localizationKeys)("taskChooseOrganization.createOrganization.formButtonReset"),onClick:e.onCancel})]})]})})]})},E=()=>{let{signOut:e}=(0,o.cL)(),{user:t}=(0,o.aF)(),{session:a}=(0,o.kP)(),{otherSessions:n}=(0,u.j)({user:t}),{navigateAfterSignOut:c,navigateAfterMultiSessionSingleSignOutUrl:d}=(0,r.useSignOutContext)(),g=t?.primaryEmailAddress?.emailAddress??t?.username;return(0,i.tZ)(l.Z.Footer,{children:(0,i.BX)(l.Z.Action,{elementId:"signOut",gap:2,justify:"center",sx:()=>({width:"100%"}),children:[g&&(0,i.tZ)(l.Z.ActionText,{truncate:!0,localizationKey:(0,s.localizationKeys)("taskChooseOrganization.signOut.actionText",{identifier:g})}),(0,i.tZ)(l.Z.ActionLink,{sx:()=>({flexShrink:0}),onClick:()=>0===n.length?e(c):e(d,{sessionId:a?.id}),localizationKey:(0,s.localizationKeys)("taskChooseOrganization.signOut.actionLink")})]})})},R=(0,c.withCardStateProvider)(e=>{let[t,a]=(0,n.useState)(e.initialFlow);return"create"===t?(0,i.tZ)(B,{onCancel:"choose"===e.initialFlow?()=>a("choose"):void 0,organizationCreationDefaults:e.organizationCreationDefaults}):(0,i.tZ)(f,{onCreateOrganizationClick:()=>a("create")})});function X(){return(0,i.tZ)(s.Flow.Root,{flow:"taskChooseOrganization",children:(0,i.tZ)(s.Flow.Part,{part:"organizationCreationDisabled",children:(0,i.BX)(l.Z.Root,{children:[(0,i.tZ)(l.Z.Content,{children:(0,i.BX)(d.h.Root,{showLogo:!0,children:[(0,i.tZ)(d.h.Title,{localizationKey:(0,s.localizationKeys)("taskChooseOrganization.organizationCreationDisabled.title")}),(0,i.tZ)(d.h.Subtitle,{localizationKey:(0,s.localizationKeys)("taskChooseOrganization.organizationCreationDisabled.subtitle")})]})}),(0,i.tZ)(E,{})]})})})}let N=(0,r.withCoreSessionSwitchGuard)((0,z.U)((0,c.withCardStateProvider)(()=>{let{user:e}=(0,o.aF)(),{userMemberships:t,userSuggestions:a,userInvitations:n}=(0,h.H)(),{organizationSettings:c}=(0,r.useEnvironment)(),d=(0,g.ib)(c.organizationCreationDefaults?.enabled?e?.getOrganizationCreationDefaults:void 0,"organization-creation-defaults"),u=t?.isLoading||n?.isLoading||a?.isLoading||d?.isLoading,z=!!(t?.count||n?.count||a?.count);return u||e?.createOrganizationEnabled||z?(0,i.tZ)(s.Flow.Root,{flow:"taskChooseOrganization",children:(0,i.tZ)(s.Flow.Part,{part:"chooseOrganization",children:(0,i.BX)(l.Z.Root,{children:[(0,i.tZ)(l.Z.Content,{sx:e=>({padding:`${e.space.$8} ${e.space.$none} ${e.space.$none}`,gap:e.space.$7}),children:u?(0,i.tZ)(s.Flex,{direction:"row",align:"center",justify:"center",sx:e=>({height:"100%",minHeight:e.sizes.$100}),children:(0,i.tZ)(s.Spinner,{size:"lg",colorScheme:"primary",elementDescriptor:s.descriptors.spinner})}):(0,i.tZ)(R,{initialFlow:z?"choose":"create",organizationCreationDefaults:d.data})}),(0,i.tZ)(E,{})]})})}):(0,i.tZ)(X,{})}),"choose-organization"))},25135:function(e,t,a){a.d(t,{U:()=>r});var i=a(95274),o=a(96231),n=a(86988);let r=(e,t)=>{let a=e.displayName||e.name||"Component";e.displayName=a;let r=a=>{let r=(0,n.G)();return(0,o.me)(e,e=>!e.session?.currentTask||e.session.currentTask.key!==t&&!e.__internal_setActiveInProgress,({clerk:e})=>e.session?r.redirectUrlComplete??e.buildAfterSignInUrl():e.buildSignInUrl(),i.q.cannotRenderComponentWhenTaskDoesNotExist)(a)};return r.displayName=`withTaskGuard(${a})`,r}}}]);